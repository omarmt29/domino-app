<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detector de Puntos de Dominó</title>
    <script async src="https://docs.opencv.org/master/opencv.js" type="text/javascript"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
        }
        video, canvas {
            margin: 10px 0;
            border: 1px solid #ddd;
            max-width: 90%;
        }
        #canvasOutput {
            filter: blur(5px);
        }
    </style>
</head>
<body>
    <h1>Detector de Puntos de Dominó</h1>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" width="640" height="480"></canvas>
    <canvas id="canvasOutput" width="640" height="480"></canvas>
    <p>Posiciona una ficha de dominó frente a la cámara.</p>
    <button id="toggleCamera">Cambiar cámara</button>

    <script>
        let currentStream;
        let video = document.getElementById('video');
        let isFrontCamera = true; // Variable para almacenar el estado de la cámara (frontal o trasera)

        // Función para acceder a la cámara
        function startCamera(deviceId) {
            if (currentStream) {
                // Detener el stream anterior si existe
                currentStream.getTracks().forEach(track => track.stop());
            }

            navigator.mediaDevices.getUserMedia({
                video: {
                    deviceId: deviceId ? { exact: deviceId } : undefined
                }
            }).then((stream) => {
                currentStream = stream;
                video.srcObject = stream;
                video.play();
            }).catch((err) => {
                console.error('Error al acceder a la cámara:', err);
            });
        }

        // Obtener la lista de dispositivos de medios
        navigator.mediaDevices.enumerateDevices().then(devices => {
            // Filtrar solo las cámaras
            const videoDevices = devices.filter(device => device.kind === 'videoinput');
            
            // Establecer la cámara frontal por defecto
            startCamera(videoDevices.find(device => device.facing === 'user')?.deviceId);
            
            // Cambiar de cámara al hacer clic en el botón
            document.getElementById('toggleCamera').addEventListener('click', () => {
                isFrontCamera = !isFrontCamera; // Cambiar el estado de la cámara
                const selectedDevice = videoDevices.find(device => isFrontCamera ? device.facing === 'user' : device.facing === 'environment');
                startCamera(selectedDevice?.deviceId);
            });
        });
    </script>
</body>
</html>
